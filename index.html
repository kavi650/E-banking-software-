<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e-Banking System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        h2 { text-align: center; color: #333; }
        input, button, select { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background-color: #007BFF; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    </style>
</head>
<body>

    <div class="container">
        <div id="loginPanel">
            <h2>E-Banking Login</h2>

            <div id="roleSelection">
                <h3>Select Your Role</h3>
                <button onclick="showLoginForm('admin')">Admin</button>
                <button onclick="showLoginForm('customer')">Customer</button>
            </div>

            <div id="adminLoginForm" class="hidden">
                <h3>Admin Login</h3>
                <input type="text" id="adminLoginId" placeholder="Admin ID">
                <input type="password" id="adminLoginPassword" placeholder="Password">
                <button onclick="login('admin')">Login as Admin</button>
                <button onclick="backToRoleSelection()">Back</button>
            </div>

            <div id="customerLoginForm" class="hidden">
                <h3>Customer Login</h3>
                <input type="text" id="customerLoginId" placeholder="ID or Phone Number">
                <input type="password" id="customerLoginPassword" placeholder="Password or PIN">
                <button onclick="login('customer')">Login as Customer</button>
                <button onclick="backToRoleSelection()">Back</button>
            </div>
        </div>

        <div id="adminPanel" class="hidden">
            <h2>Admin Dashboard</h2>
            <p>Welcome, Admin!</p>
            
            <div class="section">
                <h3>Create New Account</h3>
                <input type="text" id="custName" placeholder="Customer Name">
                <input type="text" id="custMobile" placeholder="Mobile Number">
                <input type="text" id="custAddress" placeholder="Address">
                <input type="date" id="custDob">
                <input type="text" id="custAadhar" placeholder="Aadhar Card Number">
                <button onclick="createAccount()">Create Account</button>
            </div>
            
            <div class="section">
                <h3>Deposit Money to Account</h3>
                <input type="text" id="adminDepositAccNum" placeholder="Account Number">
                <input type="number" id="adminDepositAmount" placeholder="Amount">
                <button onclick="adminDeposit()">Deposit</button>
            </div>
            
            <div class="section">
                <h3>View All Accounts</h3>
                <button onclick="viewAllAccounts()">Show All Accounts</button>
                <div id="allAccountsDisplay"></div>
            </div>

            <div class="section">
                <h3>View All Transactions</h3>
                <input type="date" id="startDate">
                <input type="date" id="endDate">
                <button onclick="viewTransactions()">View Transactions</button>
                <div id="transactionHistoryDisplay"></div>
            </div>
            <button onclick="logout()">Logout</button>
        </div>

        <div id="customerPanel" class="hidden">
            <h2>Customer Dashboard</h2>
            <p>Welcome, <span id="customerNameDisplay"></span>!</p>

            <div class="section">
                <h3>Account Operations</h3>
                <button onclick="toggleOperation('deposit')">Deposit</button>
                <button onclick="toggleOperation('withdraw')">Withdrawal</button>
                <button onclick="toggleOperation('transfer')">Transfer</button>
                
                <div id="depositForm" class="hidden">
                    <h4>Deposit Money</h4>
                    <input type="number" id="depositAmount" placeholder="Amount">
                    <button onclick="depositMoney()">Deposit</button>
                </div>
                
                <div id="withdrawForm" class="hidden">
                    <h4>Withdraw Money</h4>
                    <input type="number" id="withdrawAmount" placeholder="Amount">
                    <button onclick="withdrawMoney()">Withdraw</button>
                </div>
                
                <div id="transferForm" class="hidden">
                    <h4>Transfer Money</h4>
                    <input type="text" id="transferAccNum" placeholder="Destination Account Number">
                    <input type="number" id="transferAmount" placeholder="Amount">
                    <button onclick="transferMoney()">Transfer</button>
                </div>
            </div>

            <div class="section">
                <h3>View Balance & History</h3>
                <button onclick="viewBalance()">View Balance</button>
                <div id="balanceDisplay"></div>
                <button onclick="viewCustomerTransactions()">View Transaction History</button>
                <div id="customerTransactionHistoryDisplay"></div>
            </div>
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <script>
        // Function to generate a random 8-digit number for the account and 4-digit PIN
        const generateAccountNumber = () => Math.floor(10000000 + Math.random() * 90000000).toString();
        const generatePin = () => Math.floor(1000 + Math.random() * 9000).toString();

        // Load data from localStorage or initialize with default values
        let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

        // Save data to localStorage
        const saveData = () => {
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('transactions', JSON.stringify(transactions));
        };

        // Current logged-in user
        let currentUser = null;

        // DOM elements
        const loginPanel = document.getElementById('loginPanel');
        const adminPanel = document.getElementById('adminPanel');
        const customerPanel = document.getElementById('customerPanel');
        
        const roleSelection = document.getElementById('roleSelection');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const customerLoginForm = document.getElementById('customerLoginForm');

        const adminLoginIdInput = document.getElementById('adminLoginId');
        const adminLoginPasswordInput = document.getElementById('adminLoginPassword');
        const customerLoginIdInput = document.getElementById('customerLoginId');
        const customerLoginPasswordInput = document.getElementById('customerLoginPassword');

        const customerNameDisplay = document.getElementById('customerNameDisplay');
        const balanceDisplay = document.getElementById('balanceDisplay');
        const customerTransactionHistoryDisplay = document.getElementById('customerTransactionHistoryDisplay');
        const transactionHistoryDisplay = document.getElementById('transactionHistoryDisplay');
        const allAccountsDisplay = document.getElementById('allAccountsDisplay');

        // Functions to show/hide login forms
        const showLoginForm = (role) => {
            roleSelection.classList.add('hidden');
            if (role === 'admin') {
                adminLoginForm.classList.remove('hidden');
            } else {
                customerLoginForm.classList.remove('hidden');
            }
        };

        const backToRoleSelection = () => {
            adminLoginForm.classList.add('hidden');
            customerLoginForm.classList.add('hidden');
            roleSelection.classList.remove('hidden');
        };

        // Login function
        const login = (role) => {
            let id, password;
            if (role === 'admin') {
                id = adminLoginIdInput.value;
                password = adminLoginPasswordInput.value;
                if (id === 'admin' && password === 'a123') {
                    currentUser = { type: 'admin' };
                    loginPanel.classList.add('hidden');
                    adminPanel.classList.remove('hidden');
                } else {
                    alert('Invalid admin credentials.');
                }
            } else { // role === 'customer'
                id = customerLoginIdInput.value;
                password = customerLoginPasswordInput.value;
                const user = accounts.find(acc => acc.mobile === id && acc.pin === password);
                if (user) {
                    currentUser = { type: 'customer', data: user };
                    customerNameDisplay.textContent = user.name;
                    loginPanel.classList.add('hidden');
                    customerPanel.classList.remove('hidden');
                } else {
                    alert('Invalid customer credentials.');
                }
            }
        };

        // Logout function
        const logout = () => {
            currentUser = null;
            loginPanel.classList.remove('hidden');
            adminPanel.classList.add('hidden');
            customerPanel.classList.add('hidden');
            backToRoleSelection();
            adminLoginIdInput.value = '';
            adminLoginPasswordInput.value = '';
            customerLoginIdInput.value = '';
            customerLoginPasswordInput.value = '';
        };

        // Admin functions
        const createAccount = () => {
            const name = document.getElementById('custName').value;
            const mobile = document.getElementById('custMobile').value;
            const address = document.getElementById('custAddress').value;
            const dob = document.getElementById('custDob').value;
            const aadhar = document.getElementById('custAadhar').value;

            if (!name || !mobile || !address || !dob || !aadhar) {
                alert('Please fill all fields.');
                return;
            }

            if (accounts.some(acc => acc.mobile === mobile)) {
                alert('Account with this mobile number already exists.');
                return;
            }

            const accountNumber = generateAccountNumber();
            const pin = generatePin();

            const newAccount = {
                name,
                mobile,
                address,
                dob,
                aadhar,
                accountNumber,
                pin,
                balance: 0
            };

            accounts.push(newAccount);
            saveData();
            alert(`Account created successfully! Account Number: ${accountNumber}, PIN: ${pin}`);
        };
        
        // Admin deposit function
        const adminDeposit = () => {
            const accNum = document.getElementById('adminDepositAccNum').value;
            const amount = parseFloat(document.getElementById('adminDepositAmount').value);

            if (!accNum || amount <= 0 || isNaN(amount)) {
                alert('Please enter a valid account number and amount.');
                return;
            }

            const account = accounts.find(acc => acc.accountNumber === accNum);

            if (!account) {
                alert('Account not found.');
                return;
            }

            account.balance += amount;
            saveData();
            recordTransaction('admin-deposit', amount, accNum);
            alert(`$${amount} deposited into account ${accNum} successfully.`);
        };

        const viewAllAccounts = () => {
            if (accounts.length === 0) {
                allAccountsDisplay.innerHTML = '<p>No accounts have been created yet.</p>';
                return;
            }
            
            let tableHtml = '<table><tr><th>Name</th><th>Mobile</th><th>Account Number</th><th>PIN</th><th>Balance</th></tr>';
            accounts.forEach(acc => {
                tableHtml += `<tr><td>${acc.name}</td><td>${acc.mobile}</td><td>${acc.accountNumber}</td><td>${acc.pin}</td><td>$${acc.balance.toFixed(2)}</td></tr>`;
            });
            tableHtml += '</table>';
            allAccountsDisplay.innerHTML = tableHtml;
        };

        const viewTransactions = () => {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);

            const filteredTransactions = transactions.filter(tx => {
                const txDate = new Date(tx.date);
                return txDate >= startDate && txDate <= endDate;
            });

            displayTransactions(filteredTransactions, transactionHistoryDisplay);
        };

        // Customer functions
        const toggleOperation = (op) => {
            document.getElementById('depositForm').classList.add('hidden');
            document.getElementById('withdrawForm').classList.add('hidden');
            document.getElementById('transferForm').classList.add('hidden');
            document.getElementById(`${op}Form`).classList.remove('hidden');
        };

        const viewBalance = () => {
            const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            balanceDisplay.textContent = `Current Balance: $${customer.balance.toFixed(2)}`;
        };

        const recordTransaction = (type, amount, toAccNum = null, fromAccNum = null) => {
            const tx = {
                date: new Date().toISOString().split('T')[0],
                type,
                amount,
                fromAccount: fromAccNum,
                toAccount: toAccNum
            };
            transactions.push(tx);
            saveData();
        };

        const depositMoney = () => {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            if (amount <= 0 || isNaN(amount)) {
                alert('Invalid amount.');
                return;
            }

            const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            customer.balance += amount;
            saveData();
            recordTransaction('deposit', amount, customer.accountNumber);
            alert(`$${amount} deposited successfully.`);
            viewBalance();
        };

        const withdrawMoney = () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            
            if (amount <= 0 || isNaN(amount) || amount > customer.balance) {
                alert('Invalid amount or insufficient balance.');
                return;
            }

            customer.balance -= amount;
            saveData();
            recordTransaction('withdrawal', amount, null, customer.accountNumber);
            alert(`$${amount} withdrawn successfully.`);
            viewBalance();
        };

        const transferMoney = () => {
            const toAccNum = document.getElementById('transferAccNum').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const fromAcc = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            const toAcc = accounts.find(acc => acc.accountNumber === toAccNum);

            if (amount <= 0 || isNaN(amount) || amount > fromAcc.balance) {
                alert('Invalid amount or insufficient balance.');
                return;
            }

            if (!toAcc) {
                alert('Destination account not found.');
                return;
            }

            fromAcc.balance -= amount;
            toAcc.balance += amount;
            saveData();
            recordTransaction('transfer', amount, toAccNum, fromAcc.accountNumber);
            alert(`$${amount} transferred successfully to account ${toAccNum}.`);
            viewBalance();
        };

        const viewCustomerTransactions = () => {
            const userTransactions = transactions.filter(tx => 
                tx.fromAccount === currentUser.data.accountNumber || tx.toAccount === currentUser.data.accountNumber
            );
            displayTransactions(userTransactions, customerTransactionHistoryDisplay);
        };

        // Utility function to display transactions in a table
        const displayTransactions = (txList, element) => {
            if (txList.length === 0) {
                element.innerHTML = '<p>No transactions found.</p>';
                return;
            }

            let tableHtml = '<table><tr><th>Date</th><th>Type</th><th>Amount</th><th>Details</th></tr>';
            txList.forEach(tx => {
                let details = '';
                if (tx.type === 'transfer') {
                    details = `From: ${tx.fromAccount} To: ${tx.toAccount}`;
                } else if (tx.type === 'admin-deposit') {
                    details = `To: ${tx.toAccount}`;
                } else if (tx.type === 'deposit') {
                    details = `To: ${tx.toAccount}`;
                } else if (tx.type === 'withdrawal') {
                    details = `From: ${tx.fromAccount}`;
                }
                tableHtml += `<tr><td>${tx.date}</td><td>${tx.type}</td><td>$${tx.amount.toFixed(2)}</td><td>${details}</td></tr>`;
            });
            tableHtml += '</table>';
            element.innerHTML = tableHtml;
        };
    </script>
</body>
</html>
     const viewAllAccounts = () => {
            if (accounts.length === 0) {
                allAccountsDisplay.innerHTML = '<p>No accounts have been created yet.</p>';
                return;
            }
            
            let tableHtml = '<table><tr><th>Name</th><th>Mobile</th><th>Account Number</th><th>PIN</th><th>Balance</th></tr>';
            accounts.forEach(acc => {
                tableHtml += `<tr><td>${acc.name}</td><td>${acc.mobile}</td><td>${acc.accountNumber}</td><td>${acc.pin}</td><td>$${acc.balance.toFixed(2)}</td></tr>`;
            });
            tableHtml += '</table>';
            allAccountsDisplay.innerHTML = tableHtml;
        };

        const viewTransactions = () => {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);

            const filteredTransactions = transactions.filter(tx => {
                const txDate = new Date(tx.date);
                return txDate >= startDate && txDate <= endDate;
            });

            displayTransactions(filteredTransactions, transactionHistoryDisplay);
        };

        // Customer functions
        const toggleOperation = (op) => {
            document.getElementById('depositForm').classList.add('hidden');
            document.getElementById('withdrawForm').classList.add('hidden');
            document.getElementById('transferForm').classList.add('hidden');
            document.getElementById(`${op}Form`).classList.remove('hidden');
        };

        const viewBalance = () => {
            const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            balanceDisplay.textContent = `Current Balance: $${customer.balance.toFixed(2)}`;
        };

        const recordTransaction = (type, amount, toAccNum = null, fromAccNum = null) => {
            const tx = {
                date: new Date().toISOString().split('T')[0],
                type,
                amount,
                fromAccount: fromAccNum,
                toAccount: toAccNum
            };
            transactions.push(tx);
            saveData();
        };

        const depositMoney = () => {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            if (amount <= 0 || isNaN(amount)) {
                alert('Invalid amount.');
                return;
            }

            const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            customer.balance += amount;
            saveData();
            recordTransaction('deposit', amount, customer.accountNumber);
            alert(`$${amount} deposited successfully.`);
            viewBalance();
        };

        const withdrawMoney = () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            
            if (amount <= 0 || isNaN(amount) || amount > customer.balance) {
                alert('Invalid amount or insufficient balance.');
                return;
            }

            customer.balance -= amount;
            saveData();
            recordTransaction('withdrawal', amount, null, customer.accountNumber);
            alert(`$${amount} withdrawn successfully.`);
            viewBalance();
        };

        const transferMoney = () => {
            const toAccNum = document.getElementById('transferAccNum').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const fromAcc = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
            const toAcc = accounts.find(acc => acc.accountNumber === toAccNum);

            if (amount <= 0 || isNaN(amount) || amount > fromAcc.balance) {
                alert('Invalid amount or insufficient balance.');
                return;
            }

            if (!toAcc) {
                alert('Destination account not found.');
                return;
            }

            fromAcc.balance -= amount;
            toAcc.balance += amount;
            saveData();
            recordTransaction('transfer', amount, toAccNum, fromAcc.accountNumber);
            alert(`$${amount} transferred successfully to account ${toAccNum}.`);
            viewBalance();
        };

        const viewCustomerTransactions = () => {
            const userTransactions = transactions.filter(tx => 
                tx.fromAccount === currentUser.data.accountNumber || tx.toAccount === currentUser.data.accountNumber
            );
            displayTransactions(userTransactions, customerTransactionHistoryDisplay);
        };

        // Utility function to display transactions in a table
        const displayTransactions = (txList, element) => {
            if (txList.length === 0) {
                element.innerHTML = '<p>No transactions found.</p>';
                return;
            }

            let tableHtml = '<table><tr><th>Date</th><th>Type</th><th>Amount</th><th>Details</th></tr>';
            txList.forEach(tx => {
                let details = '';
                if (tx.type === 'transfer') {
                    details = `From: ${tx.fromAccount} To: ${tx.toAccount}`;
                } else if (tx.type === 'admin-deposit') {
                    details = `To: ${tx.toAccount}`;
                } else if (tx.type === 'deposit') {
                    details = `To: ${tx.toAccount}`;
                } else if (tx.type === 'withdrawal') {
                    details = `From: ${tx.fromAccount}`;
                }
                tableHtml += `<tr><td>${tx.date}</td><td>${tx.type}</td><td>$${tx.amount.toFixed(2)}</td><td>${details}</td></tr>`;
            });
            tableHtml += '</table>';
            element.innerHTML = tableHtml;
        };
    </script>
</body>
  </html>
