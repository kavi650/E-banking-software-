<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Secure e-Banking System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
      :root {
        --primary: #0053ba;
        --primary-dark: #00addb;
        --secondary: #6c757d;
        --danger: #dc3545;
        --background: #f4f8fb;
        --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
        --accent: #ffcc00;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, var(--background) 0%, #e6f0f7 100%);
        color: #333;
        min-height: 100vh;
        padding: 20px;
        padding-bottom: 110px;
      }

      .hidden {
        display: none !important;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
      }

      /* Header */
      .header {
        background: linear-gradient(to right, var(--primary), var(--primary-dark));
        color: white;
        padding: 1.5rem;
        border-radius: 12px 12px 0 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .header h1 {
        font-size: 2rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      #headerLogoutButton {
        background: linear-gradient(to right, var(--danger), #c82333);
        border: none;
        color: white;
        padding: 8px 18px;
        font-weight: 700;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 16px;
        transition: background 0.3s ease;
      }

      #headerLogoutButton:hover {
        background: linear-gradient(to right, #c82333, var(--danger));
      }

      /* Landing page */
      .welcome-container {
        padding: 2rem;
        text-align: center;
      }

      .welcome-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1.5rem;
      }

      .panel {
        padding: 1.5rem;
      }

      input, select, button {
        width: 100%;
        padding: 14px;
        margin: 10px 0;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 16px;
        transition: var(--transition);
      }

      input:focus, select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(0, 83, 186, 0.2);
      }

      button {
        background: linear-gradient(to right, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        padding: 14px;
        transition: var(--transition);
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .btn-secondary {
        background: linear-gradient(to right, var(--secondary), #5a6268);
      }

      .btn-danger {
        background: linear-gradient(to right, var(--danger), #c82333);
      }

      .section {
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        border: 1px solid #e1e8ed;
        border-radius: 10px;
        background: white;
        box-shadow: var(--card-shadow);
      }

      .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--primary);
      }

      .profile-info p {
        margin: 12px 0;
        font-size: 1.1em;
        display: flex;
        justify-content: space-between;
        max-width: 500px;
      }

      .profile-info strong {
        color: var(--primary);
        min-width: 150px;
      }

      .customer-nav {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .customer-nav button {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      th, td {
        padding: 12px;
        border: 1px solid #e1e8ed;
        text-align: left;
      }

      th {
        background: linear-gradient(to right, var(--primary), var(--primary-dark));
        color: white;
        font-weight: 600;
      }

      tr:nth-child(even) {
        background-color: #f8f9fa;
      }

      tr:hover {
        background-color: #e9ecef;
      }

      .balance-display {
        text-align: center;
        font-size: 2rem;
        margin: 1.5rem 0;
        color: var(--primary);
        font-weight: bold;
      }

      #walletBalanceDisplay {
        background: #fff3cd;
        color: #856404;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        padding: 0.75rem 0;
        border-radius: 8px;
      }

      /* Footer Nav */
      .footer-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100vw;
        display: flex;
        justify-content: space-around;
        align-items: center;
        background: linear-gradient(to right, var(--primary), var(--primary-dark));
        border-top: 1px solid #ddd;
        box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.15);
        padding: 6px 12px;
        z-index: 9999;
      }

      .footer-nav button {
        flex: 1;
        background: none;
        border: none;
        color: white;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        max-width: 80px;
      }

      .footer-nav i {
        font-size: 18px;
        margin-bottom: 3px;
      }

      .footer-nav .scan-btn {
        background: linear-gradient(to right, var(--primary-dark), var(--primary));
        font-size: 34px;
        width: 80px;
        height: 80px;
        border-radius: 12px;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
        color: white;
        align-items: center;
        justify-content: center;
        display: flex;
        margin-top: -30px;
        transition: all 0.25s ease;
        flex-shrink: 0;
      }

      .footer-nav .scan-btn i {
        color: #00ffee;
      }

      .footer-nav .scan-btn:hover {
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
        transform: scale(1.1) rotate(3deg);
      }

      @media (max-width: 768px) {
        .customer-nav {
          flex-direction: column;
        }

        .welcome-buttons {
          flex-direction: column;
        }

        .profile-info p {
          flex-direction: column;
        }

        .footer-nav {
          font-size: 12px;
          padding: 6px 6px;
        }

        .footer-nav .scan-btn {
          width: 65px;
          height: 65px;
          font-size: 28px;
          margin-top: -22px;
        }
      }

      /* Scanner modal */
      .qr-scanner-modal {
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.75);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .qr-scanner-video {
        max-width: 90vw;
        max-height: 60vh;
        border-radius: 12px;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
        background: #111;
      }

      .qr-close-btn {
        margin-top: 20px;
        background: var(--danger);
        color: white;
        border: none;
        padding: 12px 32px;
        font-size: 18px;
        border-radius: 8px;
        cursor: pointer;
      }

      /* Admin panel */
      .admin-panel {
        padding: 1.5rem;
      }

      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .admin-header h2 {
        margin: 0;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .admin-nav {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .admin-nav button {
        flex: 1;
        padding: 12px;
        border: 1px solid var(--primary);
        border-radius: 8px;
        background: white;
        color: var(--primary);
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .admin-nav button.active,
      .admin-nav button:hover {
        background: linear-gradient(to right, var(--primary), var(--primary-dark));
        color: white;
      }

      .admin-page {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: var(--card-shadow);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-landmark"></i> Secure e-Banking System</h1>
        <button id="headerLogoutButton" class="hidden" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
      
      <div id="landingPage">
        <div class="welcome-container">
          <h2>Welcome to Our Banking Portal</h2>
          <p>Please select your login portal to continue</p>
          <div class="welcome-buttons">
            <button onclick="showUserLogin()"><i class="fas fa-user"></i> User Login</button>
            <button onclick="showAdminLogin()"><i class="fas fa-lock"></i> Admin Login</button>
          </div>
        </div>
      </div>
      
      <div id="userLoginPanel" class="hidden panel">
        <h2><i class="fas fa-user"></i> User Login</h2>
        <div class="form-group">
          <input type="text" id="userLoginId" placeholder="Mobile Number" />
        </div>
        <div class="form-group">
          <input type="password" id="userLoginPin" placeholder="PIN" />
        </div>
        <button onclick="loginUser()"><i class="fas fa-sign-in-alt"></i> Login</button>
        <button class="btn-secondary" onclick="goHome()"><i class="fas fa-arrow-left"></i> Back to Home</button>
      </div>
      
      <div id="adminLoginPanel" class="hidden panel">
        <h2><i class="fas fa-lock"></i> Admin Login</h2>
        <div class="form-group">
          <input type="text" id="adminLoginId" placeholder="Admin ID" />
        </div>
        <div class="form-group">
          <input type="password" id="adminLoginPassword" placeholder="Password" />
        </div>
        <button onclick="loginAdmin()"><i class="fas fa-sign-in-alt"></i> Login</button>
        <button class="btn-secondary" onclick="goHome()"><i class="fas fa-arrow-left"></i> Back to Home</button>
      </div>
      
      <div id="customerPanel" class="hidden">
        <h2><i class="fas fa-user-circle"></i> Customer Dashboard</h2>
        <div class="panel">
          <p style="text-align: center; font-size: 1.2em">Welcome, <span id="customerNameDisplay"></span>!</p>
          <div id="balanceDisplay" class="balance-display"></div>
          <div id="walletBalanceDisplay" class="balance-display" style="background: #fff3cd; color: #856404">Wallet Balance: ₹0.00</div>
      
          <div class="customer-nav">
            <button onclick="showCustomerView('operations')"><i class="fas fa-cogs"></i> Operations</button>
            <button onclick="showCustomerView('profile')"><i class="fas fa-id-card"></i> Profile</button>
            <button onclick="showCustomerView('history')"><i class="fas fa-history"></i> History</button>
          </div>
      
          <div id="profileView" class="section hidden">
            <div class="section-title"><i class="fas fa-id-card"></i><h3>Your Profile</h3></div>
            <div class="profile-info">
              <p><strong>Name:</strong> <span id="profileName"></span></p>
              <p><strong>Account Number:</strong> <span id="profileAccNum"></span></p>
              <p><strong>Mobile Number:</strong> <span id="profileMobile"></span></p>
              <p><strong>Address:</strong> <span id="profileAddress"></span></p>
              <p><strong>Date of Birth:</strong> <span id="profileDob"></span></p>
              <p><strong>Aadhar Number:</strong> <span id="profileAadhar"></span></p>
            </div>
          </div>
      
          <div id="operationsView" class="section">
            <div class="section-title"><i class="fas fa-cogs"></i><h3>Account Operations</h3></div>
            <div class="customer-nav">
              <button onclick="toggleOperation('deposit')"><i class="fas fa-money-bill-wave"></i> Deposit</button>
              <button onclick="toggleOperation('withdraw')"><i class="fas fa-hand-holding-usd"></i> Withdraw to Wallet</button>
              <button onclick="toggleOperation('transfer')"><i class="fas fa-exchange-alt"></i> Transfer</button>
            </div>
            <div class="operation-forms">
              <div id="depositForm" class="hidden">
                <h4><i class="fas fa-money-bill-wave"></i> Deposit Money</h4>
                <div class="form-group"><input type="password" id="depositPin" placeholder="Enter PIN" /></div>
                <div class="form-group"><input type="number" id="depositAmount" placeholder="Amount" /></div>
                <button onclick="depositMoney()"><i class="fas fa-plus-circle"></i> Deposit</button>
              </div>
              <div id="withdrawForm" class="hidden">
                <h4><i class="fas fa-hand-holding-usd"></i> Withdraw Money (to Wallet)</h4>
                <div class="form-group"><input type="password" id="withdrawPin" placeholder="Enter PIN" /></div>
                <div class="form-group"><input type="number" id="withdrawAmount" placeholder="Amount" /></div>
                <button onclick="withdrawMoney()"><i class="fas fa-wallet"></i> Withdraw to Wallet</button>
              </div>
              <div id="transferForm" class="hidden">
                <h4><i class="fas fa-exchange-alt"></i> Transfer Money</h4>
                <div class="form-group"><input type="text" id="transferAccNum" placeholder="Destination Account Number" /></div>
                <div class="form-group"><input type="number" id="transferAmount" placeholder="Amount" /></div>
                <button onclick="transferMoney()"><i class="fas fa-paper-plane"></i> Transfer</button>
              </div>
            </div>
          </div>
      
          <div id="historyView" class="section hidden">
            <div class="section-title"><i class="fas fa-history"></i><h3>Transaction History</h3></div>
            <div id="customerTransactionHistoryDisplay"></div>
          </div>
        </div>
      </div>
      
      <div id="adminPanel" class="admin-panel hidden"></div>
      
      <div class="footer-nav" id="customerFooterNav">
        <button onclick="showCustomerView('profile')"><i class="fas fa-user"></i><br />Profile</button>
        <button class="scan-btn" onclick="openScanner()" aria-label="Scan and Pay"><i class="fas fa-qrcode"></i></button>
        <button onclick="showWalletBalance()"><i class="fas fa-wallet"></i><br />Wallet</button>
      </div>
    </div>
    
    <div id="qrScannerModal" class="qr-scanner-modal hidden">
      <video id="qrVideo" class="qr-scanner-video" autoplay playsinline></video>
      <button class="qr-close-btn" onclick="closeScannerModal()">Close</button>
    </div>
    
    <script>
      const generateAccountNumber = () => Math.floor(10000000 + Math.random() * 90000000).toString();
      let accounts = JSON.parse(localStorage.getItem("accounts")) || [];
      let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
      
      const saveData = () => {
        localStorage.setItem("accounts", JSON.stringify(accounts));
        localStorage.setItem("transactions", JSON.stringify(transactions));
      };
      
      let currentUser = null;
      const landingPage = document.getElementById("landingPage");
      const userLoginPanel = document.getElementById("userLoginPanel");
      const adminLoginPanel = document.getElementById("adminLoginPanel");
      const customerPanel = document.getElementById("customerPanel");
      const adminPanel = document.getElementById("adminPanel");
      const customerFooter = document.getElementById("customerFooterNav");
      const headerLogoutButton = document.getElementById("headerLogoutButton");
      const balanceDisplay = document.getElementById("balanceDisplay");
      const walletBalanceDisplay = document.getElementById("walletBalanceDisplay");
      const qrScannerModal = document.getElementById("qrScannerModal");
      const qrVideo = document.getElementById("qrVideo");
      let cameraStream = null;
      
      const allPanels = [landingPage, userLoginPanel, adminLoginPanel, customerPanel];
      
      function hideAllPanels() {
        allPanels.forEach(p => p.classList.add("hidden"));
        adminPanel.classList.add("hidden");
        customerFooter.style.display = "none";
        headerLogoutButton.classList.add("hidden");
        ensureScannerHidden();
      }
      
      function showUserLogin() {
        hideAllPanels();
        userLoginPanel.classList.remove("hidden");
      }
      
      function showAdminLogin() {
        hideAllPanels();
        adminLoginPanel.classList.remove("hidden");
      }
      
      function goHome() {
        hideAllPanels();
        landingPage.classList.remove("hidden");
      }
      
      function ensureScannerHidden() {
        if (!qrScannerModal.classList.contains("hidden")) {
          closeScannerModal();
        }
      }
      
      function createAdminPanel() {
        const html = `
          <div class="admin-header">
            <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
          </div>
          <div class="admin-nav">
            <button id="navCreate" onclick="showAdminPage('createAccountPage')">Create Account</button>
            <button id="navTransactions" onclick="showAdminPage('transactionsPage')">Transactions Report</button>
            <button id="navSearch" onclick="showAdminPage('searchProfilesPage')">Search Profiles</button>
          </div>
          <div class="admin-content">
            <div id="createAccountPage" class="admin-page">
              <div class="section">
                <div class="section-title"><i class="fas fa-plus-circle"></i><h3>Create New Account</h3></div>
                <div class="form-group"><input type="text" id="custName" placeholder="Customer Name" /></div>
                <div class="form-group"><input type="text" id="custMobile" placeholder="Mobile Number" /></div>
                <div class="form-group"><input type="text" id="custAddress" placeholder="Address" /></div>
                <div class="form-group"><label for="custDob">Date of Birth:</label><input type="date" id="custDob" /></div>
                <div class="form-group"><input type="text" id="custAadhar" placeholder="Aadhar Card Number" /></div>
                <div class="form-group"><input type="password" id="custPin" placeholder="Set 4-digit PIN" /></div>
                <button onclick="createAccount()"><i class="fas fa-user-plus"></i> Create Account</button>
              </div>
            </div>
            <div id="transactionsPage" class="admin-page hidden">
              <div class="section">
                <div class="section-title"><i class="fas fa-file-alt"></i><h3>View Transactions Report</h3></div>
                <div class="form-group"><input type="text" id="reportAccNum" placeholder="Account Number (Optional)" /></div>
                <div class="form-group"><label for="startDate">From Date:</label><input type="date" id="startDate" /></div>
                <div class="form-group"><label for="endDate">To Date:</label><input type="date" id="endDate" /></div>
                <button onclick="viewTransactions()"><i class="fas fa-chart-bar"></i> Generate Report</button>
                <div id="transactionHistoryDisplay"></div>
              </div>
            </div>
            <div id="searchProfilesPage" class="admin-page hidden">
              <div class="section">
                <div class="section-title"><i class="fas fa-search"></i><h3>Search Profiles</h3></div>
                <div class="form-group"><input type="text" id="searchAccNum" placeholder="Enter Account Number" /></div>
                <button onclick="searchProfile()"><i class="fas fa-search"></i> Search</button>
                <div id="searchProfileDisplay" class="search-profile-display"></div>
              </div>
            </div>
          </div>
        `;
        adminPanel.innerHTML = html;
        adminPanel.classList.remove("hidden");
        showAdminPage('createAccountPage');
      }
      
      function showAdminPage(pageId) {
        ['createAccountPage', 'transactionsPage', 'searchProfilesPage'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.classList.toggle('hidden', id !== pageId);
        });
        ['navCreate', 'navTransactions', 'navSearch'].forEach(id => {
          const btn = document.getElementById(id);
          if (btn) btn.classList.toggle('active', id + 'Page' === pageId);
        });
      }
      
      function loginUser() {
        const mobile = document.getElementById("userLoginId").value;
        const pin = document.getElementById("userLoginPin").value;
        const user = accounts.find(acc => acc.mobile === mobile && acc.pin === pin);
        
        if (user) {
          currentUser = { type: "customer", data: user };
          document.getElementById("customerNameDisplay").textContent = user.name;
          hideAllPanels();
          customerPanel.classList.remove("hidden");
          customerFooter.style.display = "flex";
          headerLogoutButton.classList.remove("hidden");
          showCustomerView("operations");
          viewBalance();
          populateProfile();
        } else {
          alert("Invalid mobile number or PIN.");
        }
      }
      
      function loginAdmin() {
        const id = document.getElementById("adminLoginId").value;
        const password = document.getElementById("adminLoginPassword").value;
        
        if (id === "admin" && password === "a123") {
          currentUser = { type: "admin" };
          hideAllPanels();
          createAdminPanel();
          customerFooter.style.display = "none";
          headerLogoutButton.classList.remove("hidden");
        } else {
          alert("Invalid admin credentials.");
        }
      }
      
      function logout() {
        currentUser = null;
        document.getElementById("userLoginId").value = "";
        document.getElementById("userLoginPin").value = "";
        document.getElementById("adminLoginId").value = "";
        document.getElementById("adminLoginPassword").value = "";
        hideAllPanels();
        goHome();
      }
      
      function showCustomerView(viewName) {
        ["operationsView", "profileView", "historyView"].forEach(id =>
          document.getElementById(id).classList.add("hidden")
        );
        document.getElementById(`${viewName}View`).classList.remove("hidden");
        if (viewName === "history") {
          viewCustomerTransactions();
        }
      }
      
      function populateProfile() {
        const user = currentUser.data;
        if (!user) return;
        document.getElementById("profileName").textContent = user.name;
        document.getElementById("profileAccNum").textContent = user.accountNumber;
        document.getElementById("profileMobile").textContent = user.mobile;
        document.getElementById("profileAddress").textContent = user.address;
        document.getElementById("profileDob").textContent = user.dob;
        document.getElementById("profileAadhar").textContent = user.aadhar;
      }
      
      function toggleOperation(op) {
        ["depositForm", "withdrawForm", "transferForm"].forEach(id =>
          document.getElementById(id).classList.add("hidden")
        );
        document.getElementById(`${op}Form`).classList.remove("hidden");
      }
      
      function viewWalletBalance() {
        const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
        if (!customer.walletBalance) customer.walletBalance = 0;
        walletBalanceDisplay.textContent = `Wallet Balance: ₹${customer.walletBalance.toFixed(2)}`;
      }
      
      function showWalletBalance() {
        const customer = accounts.find(acc => acc.accountNumber === currentUser?.data?.accountNumber);
        if (!customer) {
          alert("Please login to view wallet balance.");
          return;
        }
        if (!customer.walletBalance) customer.walletBalance = 0;
        alert(`Wallet Balance: ₹${customer.walletBalance.toFixed(2)}`);
      }
      
      function viewBalance() {
        const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
        currentUser.data = customer;
        balanceDisplay.textContent = `Account Balance: ₹${customer.balance.toFixed(2)}`;
        viewWalletBalance();
      }
      
      function recordTransaction(type, amount, toAccNum = null, fromAccNum = null) {
        transactions.push({
          date: new Date().toISOString().split("T")[0],
          type,
          amount,
          fromAccount: fromAccNum,
          toAccount: toAccNum,
        });
        saveData();
      }
      
      function depositMoney() {
        const pin = document.getElementById("depositPin").value;
        const amount = parseFloat(document.getElementById("depositAmount").value);
        const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
        
        if (pin !== customer.pin) {
          alert("Invalid PIN.");
          return;
        }
        
        if (isNaN(amount) || amount <= 0) {
          alert("Invalid amount.");
          return;
        }
        
        customer.balance += amount;
        recordTransaction("deposit", amount, customer.accountNumber);
        saveData();
        alert(`₹${amount} deposited successfully.`);
        viewBalance();
        document.getElementById("depositPin").value = "";
        document.getElementById("depositAmount").value = "";
      }
      
      function withdrawMoney() {
        const pin = document.getElementById("withdrawPin").value;
        const amount = parseFloat(document.getElementById("withdrawAmount").value);
        const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
        
        if (pin !== customer.pin) {
          alert("Invalid PIN.");
          return;
        }
        
        if (isNaN(amount) || amount <= 0 || amount > customer.balance) {
          alert("Invalid amount or insufficient balance.");
          return;
        }
        
        customer.balance -= amount;
        if (!customer.walletBalance) customer.walletBalance = 0;
        customer.walletBalance += amount;
        recordTransaction("withdrawal-to-wallet", amount, null, customer.accountNumber);
        saveData();
        alert(`₹${amount} moved to Wallet successfully.`);
        viewBalance();
        document.getElementById("withdrawPin").value = "";
        document.getElementById("withdrawAmount").value = "";
      }
      
      function transferMoney() {
        const pin = document.getElementById("transferPin").value;
        const toAccNum = document.getElementById("transferAccNum").value;
        const amount = parseFloat(document.getElementById("transferAmount").value);
        const fromAcc = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
        
        if (pin !== fromAcc.pin) {
          alert("Invalid PIN.");
          return;
        }
        
        if (fromAcc.accountNumber === toAccNum) {
          alert("You cannot transfer money to your own account.");
          return;
        }
        
        const toAcc = accounts.find(acc => acc.accountNumber === toAccNum);
        if (!toAcc) {
          alert("Destination account not found.");
          return;
        }
        
        if (isNaN(amount) || amount <= 0 || amount > fromAcc.balance) {
          alert("Invalid amount or insufficient balance.");
          return;
        }
        
        fromAcc.balance -= amount;
        toAcc.balance += amount;
        recordTransaction("transfer", amount, toAccNum, fromAcc.accountNumber);
        saveData();
        alert(`₹${amount} transferred successfully to account ${toAccNum}.`);
        viewBalance();
        document.getElementById("transferPin").value = "";
        document.getElementById("transferAccNum").value = "";
        document.getElementById("transferAmount").value = "";
      }
      
      function viewCustomerTransactions() {
        const userTransactions = transactions.filter(tx =>
          tx.fromAccount === currentUser.data.accountNumber || tx.toAccount === currentUser.data.accountNumber
        );
        displayTransactions(userTransactions, document.getElementById("customerTransactionHistoryDisplay"));
      }
      
      function displayTransactions(txList, element) {
        if (!txList.length) {
          element.innerHTML = "<p>No transactions found.</p>";
          return;
        }
        
        let tableHtml = "<table><tr><th>Date</th><th>Type</th><th>Amount</th><th>Details</th></tr>";
        txList.forEach(tx => {
          let details = "";
          if (tx.type === "transfer") {
            details = `From: ${tx.fromAccount} To: ${tx.toAccount}`;
          } else if (tx.type === "deposit") {
            details = `To: ${tx.toAccount}`;
          } else if (tx.type === "withdrawal-to-wallet") {
            details = `From: ${tx.fromAccount} to Wallet`;
          } else if (tx.type === "wallet-payment") {
            details = `Wallet payment to: ${tx.toAccount}`;
          }
          tableHtml += `<tr><td>${tx.date}</td><td>${tx.type}</td><td>₹${tx.amount.toFixed(2)}</td><td>${details}</td></tr>`;
        });
        tableHtml += "</table>";
        element.innerHTML = tableHtml;
      }
      
      // --- Scan & Pay ---
      function openScanner() {
        qrScannerModal.classList.remove("hidden");
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices.getUserMedia({
              video: {
                facingMode: "environment"
              }
            })
            .then(stream => {
              cameraStream = stream;
              qrVideo.srcObject = stream;
              qrVideo.play();
              setTimeout(() => {
                payWithWallet(50, "Merchant QR123");
                closeScannerModal();
              }, 4000);
            })
            .catch(() => {
              alert("Unable to access camera.");
              closeScannerModal();
            });
        } else {
          alert("Camera not supported on this device.");
          closeScannerModal();
        }
      }
      
      function closeScannerModal() {
        qrScannerModal.classList.add("hidden");
        if (cameraStream) {
          cameraStream.getTracks().forEach(track => track.stop());
          cameraStream = null;
        }
        qrVideo.pause();
        qrVideo.srcObject = null;
      }
      
      function payWithWallet(amount, merchant) {
        const customer = accounts.find(acc => acc.accountNumber === currentUser.data.accountNumber);
        
        if (!customer.walletBalance) customer.walletBalance = 0;
        
        if (customer.walletBalance < amount) {
          alert("Insufficient wallet balance!");
          return;
        }
        
        customer.walletBalance -= amount;
        recordTransaction("wallet-payment", amount, merchant, customer.accountNumber);
        saveData();
        alert(`Paid ₹${amount} to ${merchant} via Wallet.`);
        viewWalletBalance();
      }
    </script>
  </body>
</html>
